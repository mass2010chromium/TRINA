from math import sqrt,pi
left_limb_address = '10.1.1.30'
right_limb_address = '10.1.1.20'
## The payload and cog has to be calibrated...
# calibrated result for robotiq gripper, in klampt frame x: array([ 0.86125143,  0.05865107,  0.00479324, -0.00341504])
# The klampt in UR EE frame rotation matrix is
# 0 -0.707   0.707
# 0 - 0.707  -0.707
# 1  0        0
left_limb_payload = 0.86125
left_limb_cog = [-0.0058,-0.001,0.05865] #this needs to be in UR EE frame
right_limb_payload = 0.0
right_limb_cog = [0.0,0.0,0.0]
left_Robotiq = False
right_Robotiq = False
left_Robotiq_type = 'vacuum'
right_Robotiq_type = 'parallel'

ur5e_control_rate = 0.004 #250 Hz
left_limb_gravity_upright = [-4.91,-4.91,-6.93672]  #R_upright_newlocal * left_limb_gravity_upright = new gravity vector
right_limb_gravity_upright = [4.91,-4.91,-6.93672]
R_local_global_upright_left = [sqrt(0.5),-sqrt(0.25),-sqrt(0.25),-sqrt(0.5),-sqrt(0.25),-sqrt(0.25),0,sqrt(0.5),-sqrt(0.5)]
R_local_global_upright_right = [-sqrt(0.5),-sqrt(0.25),sqrt(0.25),-sqrt(0.5),sqrt(0.25),-sqrt(0.25),0,-sqrt(0.5),-sqrt(0.5)]
# R_local_global_upright_left = [sqrt(0.5),sqrt(0.25),sqrt(0.25),-sqrt(0.5),sqrt(0.25),sqrt(0.25),0,-sqrt(0.5),sqrt(0.5)] ## this is used when dealing with gravity vector
#R_local_global_upright_right = [sqrt(0.5),-sqrt(0.25),sqrt(0.25),sqrt(0.5),sqrt(0.25),-sqrt(0.25),0,sqrt(0.5),sqrt(0.5)]
simulated_robot_control_rate = 0.004 #250Hz
limb_velocity_limits = [2.0,2.0,2.0,2.0,2.0,2.0]
limb_EE_velocity_limits = [1.0,1.0,1.0,1.0,1.0,1.0]
epsilon = 0.01
limb_position_upper_limits = [2.0*pi-epsilon,2.0*pi-epsilon,2.0*pi-epsilon,2.0*pi-epsilon,2.0*pi-epsilon,2.0*pi-epsilon]
limb_position_lower_limits = [-2.0*pi+epsilon,-2.0*pi+epsilon,-2.0*pi+epsilon,-2.0*pi+epsilon,-2.0*pi+epsilon,-2.0*pi+epsilon]
collision_check_interval = 0.1

#commonly used arm configurations
left_untucked_config = [-0.2028,-2.1063,-1.610,3.7165,-0.9622,0.0974]
#rightUntuckedConfig = self.mirror_arm_config(leftUntuckedConfig)

##Calibration
right_calibration_configs = [[0.11264324188232422, -0.9664667409709473, 1.818247143422262, -0.852069692020752, 3.9004664421081543, -0.7985737959491175],\
    [-0.043907944356099904, -0.9470680517009278, 2.072792355214254, -0.8519972127727051, 3.9007532596588135, -0.7984898726092737],\
    [0.054299354553222656, -1.1607602399638672, 1.7276881376849573, -0.8523453038981934, 3.9007532596588135, -0.7984541098224085],\
    [-0.029310528432027638, -1.1644295018962403, 1.929971996937887, -0.8524416250041504, 3.9007651805877686, -0.79840594926943],\
    [0.15830087661743164, -1.323782281284668, 1.9610980192767542, -1.007603959446289, 4.145726203918457, -0.8638504187213343],\
    [0.2823519706726074, -1.2218292516520997, 1.738687817250387, -1.0080841344645997, 4.204855918884277, -0.9476984182940882],\
    [0.47351837158203125, -1.4614766401103516, 1.859293286000387, -0.7582662862590333, 4.250025749206543, -1.0178893248187464],\
    [0.6205134391784668, -1.442838506107666, 2.0804293791400355, -1.0922978681376954, 4.5193681716918945, -1.0183327833758753],\
    [0.3085155487060547, -1.176612214451172, 2.1993735472308558, -1.5070932668498536, 4.322521686553955, -0.531555477772848],\
    [0.11848115921020508, -0.9494765561870118, 2.1390822569476526, -1.5074528020671387, 4.32187557220459, -0.5310638586627405],
    [0.16982078552246094, -1.205845670109131, 2.1413844267474573, -1.205829457645752, 3.917790651321411, -1.5816596190081995],\
    [0.1910691261291504, -1.1021698278239747, 1.8236640135394495, -1.0596426290324708, 3.9707016944885254, -3.328471008931295],\
    [0.00789499282836914, -0.7851079267314454, 1.6004775206195276, -0.9146102231791993, 3.938478469848633, -3.2807253042804163],\
    [0.7273612022399902, -0.36806757867846684, 1.6274054686175745, -0.9103096288493653, 3.683013439178467, -3.2802208105670374],\
    [0.5704712867736816, -0.23182375848803716, 1.6262686888324183, -0.9120701116374512, 3.8526318073272705, -2.4649649302112024],\
    [0.5688657760620117, -0.17466290414843755, 1.6044066588031214, -0.9148858350566407, 3.7006826400756836, -2.2003987471209925],\
    [0.6675128936767578, -0.3591383260539551, 1.6013758818255823, -0.913867787723877, 4.108368396759033, -1.5732596556292933],\
    [0.7430663108825684, -0.2564423841289063, 1.601328198109762, -0.9140232366374512, 4.108428478240967, -0.9232428709613245]]


#[[0.4819178581237793, -0.6663234990886231, 1.7566607634173792, -0.8507736486247559, 3.703979253768921, -0.7699616591082972]],\
# [0.08375406265258789, -1.02849896371875, 2.0461791197406214, -0.8508451741984864, 3.7039670944213867, -0.7701533476458948],\
# [0.11264324188232422, -0.9664667409709473, 1.818247143422262, -0.852069692020752, 3.9004664421081543, -0.7985737959491175],\
# [-0.043907944356099904, -0.9470680517009278, 2.072792355214254, -0.8519972127727051, 3.9007532596588135, -0.7984898726092737],\
# [0.054299354553222656, -1.1607602399638672, 1.7276881376849573, -0.8523453038981934, 3.9007532596588135, -0.7984541098224085],\
# [-0.029310528432027638, -1.1644295018962403, 1.929971996937887, -0.8524416250041504, 3.9007651805877686, -0.79840594926943],\
# [0.15830087661743164, -1.323782281284668, 1.9610980192767542, -1.007603959446289, 4.145726203918457, -0.8638504187213343],\
# [0.2823519706726074, -1.2218292516520997, 1.738687817250387, -1.0080841344645997, 4.204855918884277, -0.9476984182940882],\
# [0.47351837158203125, -1.4614766401103516, 1.859293286000387, -0.7582662862590333, 4.250025749206543, -1.0178893248187464],\
# [0.6205134391784668, -1.442838506107666, 2.0804293791400355, -1.0922978681376954, 4.5193681716918945, -1.0183327833758753],\
# [0.3085155487060547, -1.176612214451172, 2.1993735472308558, -1.5070932668498536, 4.322521686553955, -0.531555477772848],\
# [0.11848115921020508, -0.9494765561870118, 2.1390822569476526, -1.5074528020671387, 4.32187557220459, -0.5310638586627405],
# [0.16982078552246094, -1.205845670109131, 2.1413844267474573, -1.205829457645752, 3.917790651321411, -1.5816596190081995],\
# [0.1910691261291504, -1.1021698278239747, 1.8236640135394495, -1.0596426290324708, 3.9707016944885254, -3.328471008931295],\
# [0.00789499282836914, -0.7851079267314454, 1.6004775206195276, -0.9146102231791993, 3.938478469848633, -3.2807253042804163],\
# [0.7273612022399902, -0.36806757867846684, 1.6274054686175745, -0.9103096288493653, 3.683013439178467, -3.2802208105670374],\
# [0.5704712867736816, -0.23182375848803716, 1.6262686888324183, -0.9120701116374512, 3.8526318073272705, -2.4649649302112024],\
# [0.5688657760620117, -0.17466290414843755, 1.6044066588031214, -0.9148858350566407, 3.7006826400756836, -2.2003987471209925]]

# [0.6675128936767578, -0.3591383260539551, 1.6013758818255823, -0.913867787723877, 4.108368396759033, -1.5732596556292933],\
# [0.7430663108825684, -0.2564423841289063, 1.601328198109762, -0.9140232366374512, 4.108428478240967, -0.9232428709613245],



###
def get_left_tool_link_N(name):
    if((name == "anthrax")|(name == "anthrax_lowpoly")):
        return 13
    elif((name == "seed")|(name == "half_anthrax")):
        return 16

def get_right_tool_link_N(name):
    if((name == "anthrax")|(name == "anthrax_lowpoly")):
        return 21
    elif((name == "seed")|(name == "half_anthrax")):
        return 41
def get_left_active_Dofs(name):
    if( (name == "anthrax")|(name == "anthrax_lowpoly")):
        return [7,8,9,10,11,12]
    elif((name == "seed")|(name == "half_anthrax")):
        return [10,11,12,13,14,15]

def get_right_active_Dofs(name):
    if((name == "anthrax")|(name == "anthrax_lowpoly")):
        return [15,16,17,18,19,20]
    elif((name == "seed")|(name == "half_anthrax")):
        return [35,36,37,38,39,40]

#TRINA_left_tool_link_N = 16
#TRINA_right_tool_link_N = 41 #seed
#TRINA_right_tool_link_N = 26 #anthrax
# TRINA_left_active_Dofs = [10,11,12,13,14,15]
# TRINA_right_active_Dofs = [35,36,37,38,39,40] #seed
#TRINA_right_active_Dofs = [20,21,22,23,24,25] #anthrax

def get_klampt_model_q(name,left_limb = [0]*6,right_limb = [0]*6,base = [0]*3):
    if((name == 'anthrax')|(name=="anthrax_lowpoly")):
        return base[0:2] + [0]*1 + [base[2]] + [0]*3 + left_limb + [0]*2 + right_limb + [0]
    elif(name == 'seed'):
        return base[0:3] + [0]*7 + left_limb + [0]*19 + right_limb + [0]*18
    elif(name == 'half_anthrax'):
        return base[0:3] + [0]*7 + left_limb + [0]*19 + [1.16] + [0]*5 + [0]*18 #at a position that does not collide with left limb
    else:
        print("wrong model name used.")
        return None


###To add a new robot model:
# create a new world file contained the model_name
# update the functions defined where
# when using the motion api, specify the correct model name
